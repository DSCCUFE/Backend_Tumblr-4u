<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Modules/Users/Controller/control.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Modules/Users/Controller/control.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>///////////////////////////////////////////////////////////
/// &lt;==> /// This File Contains User Functions /// &lt;==> ///
///////////////////////////////////////////////////////////

/* ====================== /// &lt;==> Variables Declaration &lt;==> /// ====================== */
const bcrypt = require('bcrypt');
const jwt = require('jsonwebtoken');
const { StatusCodes } = require('http-status-codes');
const users = require('../Model/model');
/* =========== /// &lt;==> End &lt;==> ===========*/

/* ====================== /// &lt;==> User Functions &lt;==> /// ====================== */


/* ----------- &lt;---> Sign Up &lt;---> ----------- */ // *** &lt;===> Done &lt;===>  *** //
// Assumption: Account Must Be Not Deleted

/**
 * This Function Used To Register New User.
 * 
 * @param {string} email - email
 * @param {string} password - password
 * @param {string} blogName - blogName
 * @param {string} age - age
 * @param {number} city - city
 * @param {string} country - country
 * 
 * @returns {object} - { Object }
 */

const signUp = async(request, response) => {
    try {
        let { email, password, blogName, age, city, country } = request.body;

        const oldUserEmail = await users.findOne({ email, isDeleted: false });
        const oldUserBlog = await users.findOne({ name: blogName, isDeleted: false });

        if (oldUserEmail) {
            response.status(StatusCodes.BAD_REQUEST).json({
                "meta": {
                    "status": 400,
                    "msg": "BAD_REQUEST"
                },

                "response": {
                    "error": 'Email is Already Exists (&lt;:>)',
                    "data": ""
                }
            });
        }

        //--------------- Search On Blogs Name ----------------//
        else if (oldUserBlog) {
            response.status(StatusCodes.BAD_REQUEST).json({
                "meta": {
                    "status": 400,
                    "msg": "BAD_REQUEST"
                },

                "response": {
                    "error": 'Blog Name is Already Exists (&lt;:>)',
                    "data": ""
                }
            });
        } else {
            const newUser = new users({ email, password, name: blogName, age, city, country });
            const data = await newUser.save();

            //--------------- Create Primary Blog ----------------//

            const token = jwt.sign({ email, role: 'user' }, process.env.KEY);

            response.status(StatusCodes.CREATED).json({
                "meta": {
                    "status": 201,
                    "msg": 'CREATED'
                },

                "response": {
                    "message": 'Sign Up Successfully (&lt;:>)',
                    "data": token
                }
            });
        }

    } catch (error) {
        response.status(StatusCodes.INTERNAL_SERVER_ERROR).json({
            "meta": {
                "status": 500,
                "msg": 'INTERNAL_SERVER_ERROR'
            },

            "response": {
                "error": 'Error In Sign Up Function (&lt;:>)',
                "data": ''
            }
        });
    };
};

/* ----------- &lt;---> Sign In &lt;---> ----------- */ // *** &lt;===> Done &lt;===>  *** //
//Assumption: Acount Must Be Not ( Deleted )

/**
 * This Function Used To LogIn To Tumblr4U.
 * 
 * @param {string} email - username
 * @param {string} password - email
 * 
 * @returns {object} - { Object }
 */

const login = async(request, response) => {
    try {
        let { email, password } = request.body;
        const oldUser = await users.findOne({ email, isDeleted: false });
        if (oldUser) {
            const match = await bcrypt.compare(password, oldUser.password);
            if (match) {
                const token = jwt.sign({ email: oldUser.email, role: oldUser.role }, process.env.KEY);
                response.status(StatusCodes.OK).json({
                    "meta": {
                        "status": 200,
                        "msg": 'OK'
                    },

                    "response": {
                        "message": 'LogIn Successfully (&lt;:>)',
                        "data": token
                    }
                });
            } else
                response.status(StatusCodes.BAD_REQUEST).json({
                    "meta": {
                        "status": 400,
                        "msg": "BAD_REQUEST"
                    },

                    "response": {
                        "error": 'InCorrect Password (&lt;:>)',
                        "data": ''
                    }
                });
        } else
            response.status(StatusCodes.BAD_REQUEST).json({
                "meta": {
                    "status": 400,
                    "msg": "BAD_REQUEST"
                },

                "response": {
                    "error": 'Email Is Not Found (&lt;:>)',
                    "data": ''
                }
            });

    } catch (error) {
        response.status(StatusCodes.INTERNAL_SERVER_ERROR).json({
            "meta": {
                "status": 500,
                "msg": 'INTERNAL_SERVER_ERROR'
            },

            "response": {
                "error": 'Error In LogIn Function (&lt;:>)',
                "data": ''
            }
        });
    };
};


/* =========== /// &lt;==> End &lt;==> ===========*/

/* ====================== /// &lt;==> Export User Functions &lt;==> /// ====================== */
module.exports = {
    signUp,
    login,
};
/* =========== /// &lt;==> End &lt;==> ===========*/</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#Connection">Connection</a></li><li><a href="global.html#isAuthorized">isAuthorized</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#signUp">signUp</a></li><li><a href="global.html#ValidateRequest">ValidateRequest</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Nov 19 2021 14:51:19 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
